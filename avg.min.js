!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LAYER_TYPE_IMAGE="image",t.LAYER_TYPE_TEXT="text",t.DEFUALT_FONT="32px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Layer=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.layer,r=t.x,o=void 0===r?0:r,i=t.y,u=void 0===i?0:i,a=t.alpha,s=void 0===a?1:a,c=t.rotate,f=void 0===c?0:c,l=t.rotatePointX,h=void 0===l?0:l,p=t.rotatePointY,v=void 0===p?0:p,d=t.dx,y=void 0===d?o:d,_=t.dy,b=void 0===_?u:_,g=t.rotatePointx,w=void 0===g?h:g,P=t.rotatePointy,m=void 0===P?v:P,x=t.mask,k=void 0!==x&&x;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"number"!=typeof n)throw"params must have 'layer:<number>'";this.layer=n,this.dx=y,this.dy=b,this.alpha=s,this.rotate=f,this.rotatePointx=w,this.rotatePointy=m,this.mask=k,this.type,this.pixel}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._queue=new Array}return r(e,[{key:"add",value:function(e){this._queue.push(function(t){e(t)}),this._flag||this.next()}},{key:"hasNext",value:function(){return this._queue.length>0}},{key:"next",value:function(){var e,t=this;this._flag=!0,(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasNext()){e.next=6;break}return e.next=3,new Promise(function(e){t._queue[0](e)});case 3:t._queue.splice(0,1),e.next=0;break;case 6:t._flag=!1;case 7:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})})()}},{key:"clearQueue",value:function(){this._queue.splice(0,this._queue.length),this._flag=!1}}]),e}();t.EventQueue=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayer=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(1);var u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(e.layer,e.x,e.y,e.alpha,e.rotate,e.rotatePointX,e.rotatePointY,e.dx,e.dy,e.rotatePointx,e.rotatePointy,e.mask,e.text),r=void 0===n?"":n,i=e.font,u=void 0===i?o.DEFUALT_FONT:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,arguments[0]));return a.type=o.LAYER_TYPE_TEXT,a.text=r,a.font=u,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Layer),r(t,[{key:"setText",value:function(e){return!("string"!=typeof e&&!e.toString)&&""+e}},{key:"setFont",value:function(e){return!("string"!=typeof e&&!e.toString)&&""+e}}]),t}();t.TextLayer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayer=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=n(1);var i=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(e.layer,e.sx),o=void 0===n?0:n,i=e.sy,u=void 0===i?0:i,a=e.swidth,s=e.sheight,c=(e.x,e.y,e.width),f=e.height,l=(e.alpha,e.rotate,e.rotatePointX,e.rotatePointY,e.sWidth),h=void 0===l?a:l,p=e.sHeight,v=void 0===p?s:p,d=e.dWidth,y=void 0===d?c:d,_=e.dHeight,b=void 0===_?f:_,g=(e.dx,e.dy,e.rotatePointx,e.rotatePointy,e.mask,e.src),w=e.img,P=void 0===w?new Image:w;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,arguments[0]));m.type=r.LAYER_TYPE_IMAGE,m.pixel=P,m.sx=o,m.sy=u;var x=function(e){return"number"==typeof e};return x(y)&&(m.dWidth=y),x(b)&&(m.dHeight=b),x(h)&&(m.sWidth=h),x(v)&&(m.sHeight=v),switchInstanceof(m.pixel,[[HTMLImageElement,function(e){var t=function(){x(m.dWidth)||(m.dWidth=e.naturalWidth),x(m.dHeight)||(m.dHeight=e.naturalHeight),x(m.sWidth)||(m.sWidth=e.naturalWidth),x(m.sHeight)||(m.sHeight=e.naturalHeight)};if(g&&(m.pixel.src=g),m.pixel.complete)t();else{m.pixel.addEventListener("load",function e(){t(),m.pixel.removeEventListener("load",e)})}}],[HTMLCanvasElement,function(e){x(m.dWidth)||(m.dWidth=e.width),x(m.dHeight)||(m.dHeight=e.height),x(m.sWidth)||(m.sWidth=e.width),x(m.sHeight)||(m.sHeight=e.height)}]]),m}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Layer),t}();t.ImageLayer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoopQueue=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2);var i=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return new Promise(function(e){return e()})};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._loopFun=e,r._resFun=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventQueue),r(t,[{key:"next",value:function(){var e,t=this;this._flag=!0,(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasNext()){e.next=6;break}return e.next=3,new Promise(function(e){t._queue[0](e)});case 3:t._queue.splice(0,1),e.next=0;break;case 6:t._flag=!1,t._loopFun();case 8:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})})()}},{key:"setLoopFunction",value:function(e){if("function"!=typeof e)throw"LoopFunction Param is not a function!";this._loopFun=e}},{key:"setResloveFunction",value:function(e){this._resFun=e}},{key:"clearQueue",value:function(){this._queue.splice(0,this._queue.length),this._flag=!1,this._loopFun=function(){},this._resFun()}}]),t}();t.LoopQueue=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.switchInstanceof=function(e,t){t.forEach(function(t){e instanceof t[0]&&t[1](e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Avg=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(n(0)),n(6),n(2)),i=n(5);n(4),n(3);function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.target,r=void 0===n?document.createElement("canvas"):n;t.height,t.width;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._canvasMain,Object.defineProperty(this,"_canvasMain",{value:r,writable:!1}),this._canvasMask,Object.defineProperty(this,"_canvasMask",{value:document.createElement("canvas"),writable:!1}),this._eQ=this._nextEventQueue(),this._paintBrush,Object.defineProperty(this,"_paintBrush",{value:this.getBrush(),writable:!1}),this._paintBrushForMask,Object.defineProperty(this,"_paintBrushForMask",{value:this.getBrush(!0),writable:!1}),this._layers,Object.defineProperty(this,"_layers",{value:new Array,writable:!1}),this._loopPliesCount=0}return r(e,[{key:"setSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,n=void 0===t?1280:t,r=e.height,o=void 0===r?720:r;[this.getCanvas(),this.getCanvas(!0)].forEach(function(e){e.width=n,e.height=o})}},{key:"getCanvas",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._canvasMain:this._canvasMask}},{key:"getBrush",value:function(){return(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._canvasMain:this._canvasMask).getContext("2d")}},{key:"wait",value:function(e){this._eQ.add(function(t){var n=performance.now();(e-=13.34)<0&&(e=0);requestAnimationFrame(function r(){performance.now()-n>=e?t():requestAnimationFrame(r)})})}},{key:"sleep",value:function(e){this.wait(e)}},{key:"runFunction",value:function(e){var t,n=this;this._eQ.add((t=u(regeneratorRuntime.mark(function t(r){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=18;break;case 5:if(t.prev=5,t.t0=t.catch(0),!t.t0.info||"BREAK_BY_AVG"!==t.t0.info){t.next=16;break}if(!(t.t0.plies<=n._loopPliesCount)){t.next=13;break}for(n._loopPliesCount-=t.t0.plies,o=0;o<t.t0.plies;o++)n._eQ.clearQueue(),n._eQ=n._lastEventQueue();t.next=14;break;case 13:throw"break loops' param too large";case 14:t.next=18;break;case 16:throw console.log("runFunction runError"),t.t0;case 18:return t.prev=18,r(),t.finish(18);case 21:case"end":return t.stop()}},t,n,[[0,5,18,21]])})),function(e){return t.apply(this,arguments)}))}},{key:"run",value:function(e){this.runFunction(e)}},{key:"loopFunction",value:function(e){var t,n=this;this._eQ.add((t=u(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n._loopPliesCount++,n._eQ=n._nextEventQueue("loopQueue",function(){n.runFunction(e)},r),n.runFunction(e);case 3:case"end":return t.stop()}},t,n)})),function(e){return t.apply(this,arguments)}))}},{key:"loop",value:function(e){this.loopFunction(e)}},{key:"breakLoopFunction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if("number"!=typeof e)throw"can not break function by a wrong plies";throw{plies:e,info:"BREAK_BY_AVG"}}},{key:"break",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.breakLoopFunction(e)}},{key:"_nextEventQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eventQueue",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return new Promise(function(e){return e()})};if(this._eQPointer,this._eQArray,void 0!==this._eQPointer&&this._eQArray||(this._eQPointer=-1,this._eQArray=new Array),this._eQPointer++,!this._eQArray[this._eQPointer])switch(e){case"eventQueue":this._eQArray[this._eQPointer]=new o.EventQueue;break;case"loopQueue":this._eQArray[this._eQPointer]=new i.LoopQueue}return this._eQArray[this._eQPointer].__proto__.constructor===i.LoopQueue&&(this._eQArray[this._eQPointer].setLoopFunction(t),this._eQArray[this._eQPointer].setResloveFunction(n)),this._eQArray[this._eQPointer]}},{key:"_lastEventQueue",value:function(){if(void 0===this._eQPointer||!this._eQArray)throw"No Queque in Array!";return this._eQPointer--,this._eQPointer<0&&(this._eQPointer=0),this._eQArray[this._eQPointer]}}]),e}();t.Avg=a,t.default=a},function(e,t,n){"use strict";n(7)}]);
//# sourceMappingURL=avg.min.js.map