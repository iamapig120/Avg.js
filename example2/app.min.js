function testImpact(e,a){return e.bottom=e.y+e.height,e.right=e.x+e.width,a.bottom=a.y+a.height,a.right=a.x+a.width,!(e.right<a.x)&&(!(e.x>a.right)&&(e.bottom>a.y&&e.bottom<a.bottom||e.y<a.bottom&&e.y>a.y))}function randBirdImgFun(){randBirdImg=`image/birds${parseInt(3*Math.random())}.png`}function gameOver(){canPlay&&(canPlay=!1,hiScore<score&&(hiScore=score),localStorage.setItem("FlappyBirdHiScore",hiScore),console.log("HI SCORE : "+hiScore),avg.playSE({src:"audio/game_over.mp3"}),avg.stopBGM({time:500}))}function jump(){canPlay&&(avg.playSE({audio:GAME_SE}),speedy=-12)}const GAME_BG_RAND_LIST=new function(){const e=["game_music.mp3"];this.toString=function(){return`audio/${e[parseInt(e.length*Math.random())]}`}};let cheater=!1;const GAME_BG=new Audio(GAME_BG_RAND_LIST),GAME_SE=new Audio("audio/bullet.mp3"),GAME_SPEED=90,GAME_EASY=180;let hiScore=localStorage.getItem("FlappyBirdHiScore");hiScore=hiScore?parseInt(hiScore):0,avg.creaveWindow({width:336,height:600,volumeBGM:.5}),avg.wait(2e3),avg.playBGM({audio:GAME_BG}),avg.loadImage({layer:1,src:"image/sky.png"}),avg.loadImage({layer:24,src:"image/ground.png",y:488}),avg.removeLayer({layer:24,fun:e=>{avg.setLayer({layer:12,from:e})}}),avg.loadImage({layer:13,src:"image/ground.png",x:336,y:488}),avg.loadImage({layer:4,src:"image/pie_top.png",x:336}),avg.loadImage({layer:5,src:"image/pie_down.png",x:336}),avg.loadImage({layer:6,src:"image/pie_top.png",x:336}),avg.loadImage({layer:7,src:"image/pie_down.png",x:336});let randBirdImg,bird=0,birdx=50,birdy=200,speed=6,speedy=0,rotate=0,frame=0,scoreImgWidth=40,score=0,reFreshGround=!1,canPlay=!0,piping2=!1;const getRandPipingTop=new function(){this.toString=function(){return 20+parseInt(250*Math.random())}};let randPipingTop=getRandPipingTop.toString(),randPipingTop2=getRandPipingTop.toString();avg.getDOM().addEventListener("click",function(){jump()}),document.documentElement.addEventListener("keydown",function(e){jump()}),document.documentElement.addEventListener("keyup",function(e){67==e.keyCode&&canPlay&&(cheater=!cheater)}),avg.run(randBirdImgFun),avg.run(function e(a){if(frame++,speedy+=.75,(birdy+=speedy)<0&&(birdy=0),birdy>464&&(birdy=464,gameOver()),speedy>15&&(speedy=15),rotate=90/Math.PI*Math.atan(speedy/speed),90==frame?(randPipingTop2=getRandPipingTop.toString(),canPlay&&score++,piping2=!0,reFreshGround=!0):180==frame&&(randPipingTop=getRandPipingTop.toString(),canPlay&&score++,reFreshGround=!0,frame=0),canPlay&&(reFreshGround&&(reFreshGround=!1,avg.move({layer:12,x:0}),avg.move({layer:13,x:336})),avg.move({layer:12,x:0-frame%90*336/90},0),avg.move({layer:13,x:336-frame%90*336/90},0)),canPlay&&(frame%4==0&&3==++bird&&(bird=0),avg.move({layer:4,x:336-frame/90*336,y:randPipingTop-420}),avg.move({layer:5,x:336-frame/90*336,y:randPipingTop+180}),piping2)){let e=frame;e>=90?e-=90:e+=90,avg.move({layer:6,x:336-e/90*336,y:randPipingTop2-420}),avg.move({layer:7,x:336-e/90*336,y:randPipingTop2+180})}avg.loadImage({layer:14,src:randBirdImg,x:birdx,y:birdy,width:34,height:24,sx:34*bird,sy:0,swidth:34,sheight:24,rotate:rotate,rotatePointX:birdx+17,rotatePointY:birdy+12}),avg.run(()=>{if(cheater&&canPlay){const e=avg.getLayerClientRect(5),a=avg.getLayerClientRect(7),t=avg.getLayerClientRect(14),r=t.y+t.height;let i=!1;r<20&&(i=!0),e.x<336&&e.x+e.width>-1&&e.y-16<r&&(i=!0),a.x<336&&a.x+a.width>-1&&a.y-16<r&&(i=!0),i&&avg.getDOM().click()}if(canPlay){let e=(score+"").length,a=score,t=parseInt(336-(336-e*scoreImgWidth)/2-scoreImgWidth);for(let r=0;r<e;r++)avg.loadImage({layer:16+r,src:"image/scoreBig.png",x:parseInt(t-r*scoreImgWidth),y:48,width:40,height:60,sx:parseInt(a%10)*scoreImgWidth,sy:0,swidth:40,sheight:60}),a/=10;(testImpact(avg.getLayerClientRect(14),avg.getLayerClientRect(4))||testImpact(avg.getLayerClientRect(14),avg.getLayerClientRect(5))||testImpact(avg.getLayerClientRect(14),avg.getLayerClientRect(6))||testImpact(avg.getLayerClientRect(14),avg.getLayerClientRect(7)))&&gameOver()}}),avg.waitByFrame(1),avg.run(e)});